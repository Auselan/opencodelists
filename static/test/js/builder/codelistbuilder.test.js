"use strict";

import React from "react";
import { render, unmountComponentAtNode } from "react-dom";
import { act } from "react-dom/test-utils";

import CodelistBuilder from "../../../src/js/builder/codelistbuilder";
import Hierarchy from "../../../src/js/hierarchy";

let container = null;
beforeEach(() => {
  container = document.createElement("div");
  document.body.appendChild(container);
});

afterEach(() => {
  unmountComponentAtNode(container);
  container.remove();
  container = null;
});

it("renders", () => {
  const searches = [
    {
      term: "ketoacidosis",
      url: "/builder/peter-inglesby/diabetic-ketoacidosis/search/ketoacidosis/",
      active: false,
    },
  ];
  const filter = null;
  const codeToStatus = {
    420270002: "?",
    190406000: "?",
    421847006: "?",
    56051008: "?",
    473180009: "?",
    26298008: "?",
    420422005: "?",
    735537007: "?",
    55571001: "?",
    421075007: "?",
    846651000000102: "?",
    55178001: "?",
    783231000000106: "?",
    111556005: "?",
    421750000: "?",
  };
  const tables = [
    {
      heading: "Disorder",
      rows: [
        {
          code: "26298008",
          status: "?",
          term: "Diabetic coma with ketoacidosis",
          pipes: [],
        },
        {
          code: "421075007",
          status: "?",
          term: "Ketoacidotic coma in type I diabetes mellitus",
          pipes: ["\u251c"],
        },
        {
          code: "421847006",
          status: "?",
          term: "Ketoacidotic coma in type II diabetes mellitus",
          pipes: ["\u2514"],
        },
        {
          code: "735537007",
          status: "?",
          term:
            "Hyperosmolar hyperglycemic coma due to diabetes mellitus without ketoacidosis",
          pipes: [],
        },
        { code: "56051008", status: "?", term: "Ketoacidosis", pipes: [] },
        {
          code: "55571001",
          status: "?",
          term: "Alcoholic ketoacidosis",
          pipes: ["\u251c"],
        },
        {
          code: "420422005",
          status: "?",
          term: "Ketoacidosis in diabetes mellitus",
          pipes: ["\u251c"],
        },
        {
          code: "111556005",
          status: "?",
          term: "Diabetic ketoacidosis without coma",
          pipes: ["\u2502", "\u251c"],
        },
        {
          code: "420270002",
          status: "?",
          term: "Ketoacidosis in type I diabetes mellitus",
          pipes: ["\u2502", "\u251c"],
        },
        {
          code: "421750000",
          status: "?",
          term: "Ketoacidosis in type II diabetes mellitus",
          pipes: ["\u2502", "\u2514"],
        },
        {
          code: "55178001",
          status: "?",
          term: "Starvation ketoacidosis",
          pipes: ["\u2514"],
        },
        {
          code: "190406000",
          status: "?",
          term: "Malnutrition-related diabetes mellitus with ketoacidosis",
          pipes: [],
        },
      ],
    },
    {
      heading: "Procedure",
      rows: [
        {
          code: "473180009",
          status: "?",
          term: "Discussion about diabetic ketoacidosis in pregnancy",
          pipes: [],
        },
        {
          code: "846651000000102",
          status: "?",
          term: "Education about ketoacidosis",
          pipes: [],
        },
      ],
    },
    {
      heading: "Situation",
      rows: [
        {
          code: "783231000000106",
          status: "?",
          term: "History of diabetic ketoacidosis",
          pipes: [],
        },
      ],
    },
  ];
  const parentMap = {
    417662000: ["243796009", "413350009"],
    421847006: ["422014003", "26298008"],
    846651000000102: ["84635008"],
    735537007: ["422126006", "310505005"],
    118940003: ["64572001", "362965005"],
    721284006: ["422014003", "51387008", "237620003"],
    123946008: ["64572001", "118234003"],
    118234003: ["404684003"],
    422014003: ["74627003"],
    237620003: ["74627003", "75934005"],
    55571001: ["56051008"],
    223482009: ["128927009"],
    422126006: ["420662003", "237620003"],
    473180009: ["223471001"],
    55178001: ["212968006", "56051008"],
    421075007: ["420868002", "26298008"],
    721283000: ["420868002", "51387008", "237620003"],
    413350009: ["243796009"],
    422088007: ["118940003", "74627003", "73211009", "116223007"],
    362965005: ["64572001", "123946008"],
    420662003: ["422088007", "73211009", "116223007", "371632003"],
    71388002: ["138875005"],
    190406000: ["75524006"],
    421750000: ["368051000119109", "721284006", "420422005"],
    367991000119101: ["420868002", "80394007", "237620003"],
    26298008: ["420662003"],
    56051008: ["51294009"],
    73211009: ["362969004", "126877002"],
    51294009: ["25998009"],
    371632003: ["118940003"],
    362969004: ["362965005"],
    404684003: ["138875005"],
    409073007: ["128927009", "71388002"],
    64572001: ["404684003"],
    2492009: ["64572001"],
    368051000119109: ["422014003", "80394007", "237620003"],
    266991009: ["417662000", "312850006"],
    116223007: ["64572001"],
    80394007: ["126877002"],
    237621004: ["80394007", "237620003"],
    243796009: ["138875005"],
    8801005: ["73211009"],
    74627003: ["64572001"],
    75524006: ["8801005"],
    420422005: ["441656006", "56051008"],
    84635008: ["409073007"],
    26436007: ["75934005"],
    441656006: ["237621004", "59455009"],
    420270002: ["721283000", "367991000119101", "420422005"],
    111556005: ["420422005"],
    223471001: ["408767007", "223482009"],
    310505005: ["441656006"],
    212968006: ["70241007"],
    25998009: ["59455009"],
    126877002: ["20957000"],
    420868002: ["74627003"],
    20957000: ["75934005"],
    75934005: ["64572001"],
    70241007: ["2492009"],
    128927009: ["71388002"],
    783231000000106: ["266991009", "519141000000107"],
    312850006: ["417662000"],
    519141000000107: ["417662000"],
    408767007: ["71388002"],
    51387008: ["26436007"],
    59455009: ["51387008"],
  };
  const childMap = {
    413350009: ["417662000"],
    26298008: ["421075007", "421847006"],
    84635008: ["846651000000102"],
    422126006: ["735537007"],
    362965005: ["362969004", "118940003"],
    51387008: ["721283000", "59455009", "721284006"],
    64572001: [
      "118940003",
      "75934005",
      "362965005",
      "2492009",
      "74627003",
      "123946008",
      "116223007",
    ],
    404684003: ["64572001", "118234003"],
    74627003: ["422088007", "422014003", "420868002", "237620003"],
    56051008: ["55571001", "55178001", "420422005"],
    128927009: ["223482009", "409073007"],
    310505005: ["735537007"],
    420662003: ["422126006", "26298008"],
    223471001: ["473180009"],
    422014003: ["368051000119109", "721284006", "421847006"],
    75934005: ["26436007", "20957000", "237620003"],
    212968006: ["55178001"],
    420868002: ["721283000", "421075007", "367991000119101"],
    237620003: [
      "422126006",
      "721284006",
      "237621004",
      "368051000119109",
      "721283000",
      "367991000119101",
    ],
    118234003: ["123946008"],
    243796009: ["417662000", "413350009"],
    123946008: ["362965005"],
    371632003: ["420662003"],
    138875005: ["71388002", "243796009", "404684003"],
    75524006: ["190406000"],
    368051000119109: ["421750000"],
    422088007: ["420662003"],
    51294009: ["56051008"],
    126877002: ["80394007", "73211009"],
    25998009: ["51294009"],
    118940003: ["422088007", "371632003"],
    312850006: ["266991009"],
    80394007: ["237621004", "368051000119109", "367991000119101"],
    362969004: ["73211009"],
    71388002: ["128927009", "408767007", "409073007"],
    73211009: ["422088007", "8801005", "420662003"],
    8801005: ["75524006"],
    409073007: ["84635008"],
    116223007: ["422088007", "420662003"],
    59455009: ["25998009", "441656006"],
    420422005: ["420270002", "111556005", "421750000"],
    223482009: ["223471001"],
    441656006: ["310505005", "420422005"],
    70241007: ["212968006"],
    237621004: ["441656006"],
    408767007: ["223471001"],
    721283000: ["420270002"],
    417662000: ["266991009", "312850006", "519141000000107"],
    20957000: ["126877002"],
    2492009: ["70241007"],
    519141000000107: ["783231000000106"],
    266991009: ["783231000000106"],
    367991000119101: ["420270002"],
    721284006: ["421750000"],
    26436007: ["51387008"],
  };
  const isEditable = true;
  const updateURL =
    "application/json" >
    "/builder/peter-inglesby/diabetic-ketoacidosis/update/";
  const searchURL = "/builder/peter-inglesby/diabetic-ketoacidosis/search/";

  const hierarchy = new Hierarchy(parentMap, childMap);

  act(() => {
    render(
      <CodelistBuilder
        searches={searches}
        filter={filter}
        codeToStatus={codeToStatus}
        tables={tables}
        isEditable={isEditable}
        updateURL={updateURL}
        searchURL={searchURL}
        hierarchy={hierarchy}
      />,
      container
    );
  });
});
